<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Node.js CRUD Test</title>
<style>
body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
input, textarea { width: 100%; margin: 5px 0; padding: 8px; }
button { padding: 8px 12px; margin: 5px 0; }
.item { border: 1px solid #ccc; padding: 10px; margin: 5px 0; }
</style>
</head>
<body>
<h1>CRUD с Node.js + MySQL</h1>

<h3>Добавить элемент</h3>
<input type="text" id="name" placeholder="Название">
<textarea id="description" placeholder="Описание"></textarea>
<button onclick="addItem()">Добавить</button>

<h3>Список элементов</h3>
<div id="items"></div>

<script>
async function loadItems() {
  const res = await fetch('/api/items');
  const data = await res.json();
  document.getElementById('items').innerHTML = data.map(item => `
    <div class="item">
      <b>${item.name}</b><br>${item.description}<br>
      <button onclick="deleteItem(${item.id})">Удалить</button>
      <button onclick="editItem(${item.id}, '${item.name}', '${item.description}')">Изменить</button>
    </div>
  `).join('');
}

async function addItem() {
  const name = document.getElementById('name').value;
  const description = document.getElementById('description').value;
  await fetch('/api/items', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, description }) });
  loadItems();
}

async function deleteItem(id) {
  await fetch('/api/items/' + id, { method: 'DELETE' });
  loadItems();
}

function editItem(id, oldName, oldDesc) {
  const name = prompt('Название:', oldName);
  const description = prompt('Описание:', oldDesc);
  if (name && description) {
    fetch('/api/items/' + id, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, description }) })
      .then(() => loadItems());
  }
}

loadItems();
</script>
</body>
</html>
