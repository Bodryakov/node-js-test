<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Node.js CRUD Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 20px auto;
        }
        h1 {
            text-align: center;
        }
        form {
            margin-bottom: 20px;
        }
        input, textarea, button {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
            font-size: 14px;
        }
        .item {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
        }
        .item button {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <h1>Node.js CRUD Test</h1>

    <form id="itemForm">
        <input type="hidden" id="itemId">
        <input type="text" id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" required>
        <textarea id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
        <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>

    <div id="items"></div>

    <script>
        const API_BASE = "http://node-js-test.bod-hub.kz:3000";

        async function loadItems() {
            const res = await fetch(`${API_BASE}/api/items`);
            const data = await res.json();
            const itemsDiv = document.getElementById("items");
            itemsDiv.innerHTML = "";
            data.forEach(item => {
                const div = document.createElement("div");
                div.className = "item";
                div.innerHTML = `
                    <strong>${item.name}</strong><br>
                    <em>${item.description || ""}</em><br>
                    <button onclick="editItem(${item.id}, '${item.name}', '${item.description || ""}')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button onclick="deleteItem(${item.id})">üóë –£–¥–∞–ª–∏—Ç—å</button>
                `;
                itemsDiv.appendChild(div);
            });
        }

        document.getElementById("itemForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const id = document.getElementById("itemId").value;
            const name = document.getElementById("name").value;
            const description = document.getElementById("description").value;

            if (id) {
                await fetch(`${API_BASE}/api/items/${id}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ name, description })
                });
            } else {
                await fetch(`${API_BASE}/api/items`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ name, description })
                });
            }
            document.getElementById("itemForm").reset();
            loadItems();
        });

        async function deleteItem(id) {
            if (confirm("–£–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç?")) {
                await fetch(`${API_BASE}/api/items/${id}`, { method: "DELETE" });
                loadItems();
            }
        }

        function editItem(id, name, description) {
            document.getElementById("itemId").value = id;
            document.getElementById("name").value = name;
            document.getElementById("description").value = description;
        }

        loadItems();
    </script>
</body>
</html>
